(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[457],{2047:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>o});var r=n(5155),s=n(2115),a=n(4589),l=n(3811),c=n.n(l);function o(){let[e,t]=(0,s.useState)([]),[n,l]=(0,s.useState)(""),[o,i]=(0,s.useState)(""),d=(0,s.useRef)(null);(0,s.useEffect)(()=>{let e=localStorage.getItem("username");if(!e){window.location.href="/login";return}return i(e),t([]),u(e),fetch("http://localhost:8080/api/chat/messages").then(e=>e.json()).then(e=>{t(e)}).catch(e=>console.error("Kunde inte h\xe4mta meddelanden:",e)),()=>{h(e)}},[]);let u=e=>{var n;if(null==(n=d.current)?void 0:n.connected)return;let r=new a.K({webSocketFactory:()=>new(c())("http://localhost:8080/ws"),reconnectDelay:5e3,onConnect:()=>{console.log("âœ… Ansluten till WebSocket"),r.subscribe("/topic/chat",e=>{let n=JSON.parse(e.body);t(e=>[...e,n])},{id:"chat-sub"}),r.publish({destination:"/app/chat.send",body:JSON.stringify({sender:e,type:"JOIN"})})},onStompError:e=>{console.error("STOMP Error:",e)}});r.activate(),d.current=r},h=e=>{let t=d.current;(null==t?void 0:t.connected)&&(t.publish({destination:"/app/chat.send",body:JSON.stringify({sender:e,type:"LEAVE"})}),t.unsubscribe("chat-sub"),t.deactivate(),d.current=null)},p=async()=>{var e;if(""===n.trim()||!(null==(e=d.current)?void 0:e.connected))return;let t={sender:o,content:n,type:"CHAT"};d.current.publish({destination:"/app/chat.send",body:JSON.stringify(t)});try{await fetch("http://localhost:8080/api/chat/message",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})}catch(e){console.error("Kunde inte spara meddelandet i DB",e)}l("")};return(0,r.jsx)("main",{className:"flex items-center justify-center min-h-screen bg-gray-200",children:(0,r.jsxs)("div",{className:"bg-white p-6 rounded-xl shadow-xl w-full max-w-2xl",children:[(0,r.jsxs)("h1",{className:"text-2xl font-bold mb-4",children:["Hej ",o," \uD83D\uDC4B"]}),(0,r.jsx)("div",{className:"border rounded p-4 mb-4 h-80 overflow-y-scroll bg-gray-100",children:e.map((e,t)=>(0,r.jsxs)("div",{className:"mb-1",children:[(0,r.jsx)("strong",{children:e.sender}),":"," ","CHAT"===e.type?e.content:(0,r.jsxs)("em",{children:[e.type.toLowerCase()," the chat"]})]},t))}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("input",{value:n,onChange:e=>l(e.target.value),onKeyDown:e=>"Enter"===e.key&&p(),className:"border p-2 flex-1 rounded",placeholder:"Skriv ett meddelande..."}),(0,r.jsx)("button",{onClick:p,className:"bg-blue-500 text-white px-4 py-2 rounded",children:"Skicka"})]})]})})}},2408:(e,t,n)=>{Promise.resolve().then(n.bind(n,2047))}},e=>{var t=t=>e(e.s=t);e.O(0,[991,441,684,358],()=>t(2408)),_N_E=e.O()}]);